# 안티패턴
## 개요
---
### 안티패턴: 널리 사용되지만 실제로는 좋지 않은 패
 - 어떤 문제를 해결하려는 의도로 사용하지만 실제로는 더 많은 문제를 유발하는 패턴

### 구성
- 논리적 데이터베이스 설계 안티패턴: 저장 정보, DB관계 정리
- 물리적 데이터베이스 설계 안티패턴: 효율적 데이터 관리로 index, DDL 정리
- 쿼리 안티패턴: 데이터 입력조회 DML
- 애플리케이션 개발 안티패턴: java, python 등 다른 언어 애플리케이션 내 사용되는 SQL

### 안티패턴의 구조
- 목표
    - 해결하려는 작업이자만 안티패턴 사용으로 더 많은 문제 발생
- 안티패턴
    - 흔한 해법의 속성과 이를 안티패턴으로 만드는 예상외 결과
- 안티패턴 인식 방법
    - 안티패턴 단서 찾기
- 안티패턴 사용이 합당한 경우
    - 예외가 있기 마련
- 해법
    - 안티패턴을 막으며 원래 목표 달성 해법

## 논리적 데이터베이스 설계 안티패턴
---
### 무단횡단
> 다대다 교차테이블 피하기 위해 쉼표 구분 데이터를 사용하는 것
- 목표
    - 담당자와 제품의 다대일 관계를 일대다 관계도 지원하기
        - 해법(상현): 중간 테이블 생성 (중간에 FK 삭제 가능?) OK
        - 해법(형주): FK없는 다대다 관계 생성
- 안티패턴
    - 쉼표로 구분된 목록에 저장
        - 특정 담당자의 제품을 찾으려면 REGEXP 패턴매칭이 필요
            - 잘못된 결과 리턴 가능
            - 인덱스 활용 불가
            - 패턴매칭은 DB 제품 마다 다름 (벤더 중립적이지 못함)
        - 주어진 제품에 대한 계정 정보 조회 불편
            - 인덱스 활용 조인 불가
        - 집계 쿼리 사용 불가 count(), sum(), avg() 등
            - 대체 로직 작성이 필요하나, 부정확하며 난해함
        - 특정 제품에 대한 계정 갱신 불편
            - 새 아이디 추가는 가능하나 정렬된 상태가 아님
            - 한 아이디 삭제 위해 큰 비용
                - 목록을 일기 -> 대상 아이디만 제거 -> 나머지 아이디 붙여서 업데이트
        - 아이디 유효성 검증 불가
            - 숫자인 아이디 경우 'banana' 같은 문자도 입력 가능
        - 구분자 문자를 포함한 데이터 문제
        - 데이터 길이 제한 varchar(30), varchar(60) ...
- 안티패턴 인식 방법
    - 이 목록이 지원하는 최대 항목 수는?
        - varchar 최대 길이 확인 위한 질문
    - SQL에서 단어 경계를 어떻게 알지?
        - 문자열 일부 검색 위한 질문
    - 이 목록에서 절대 안 나올 문자는?
        - 구분자 사용위한 질문
- 안티패턴 사용이 합당한 경우
    - 구분자 사용은 반정규화의 일종
        - 정규화가 먼저, 반정규화는 보수적으로 접근
    - 애플리케이션에서 구분자 형식의 데이터가 필요한 경우
    - 목록 내 개별 항목에 접근 필요 없는 경우
    - 다른 DB 구분자 형식 항목을 그대로 사용하며, 분리 불필요 경우 
- 해법: 교차 테이블 생성
    - Contacts 테이블로 Products와 Accounts사이 다대다 관계 구현
        - FK(product_id), FK(account_id)
        - FK로 두 테이블 참조: 교차테이블
            - 영어: join table, many-to-many table, mapping table
    - Contacts 테이블 조인으로 계정 및 제품 조회 가능
    - Group By로 집계 쿼리 가능
    - 특정 제품에 대한 계정 갱신
        - Contacts 테이블 행 추가 및 삭제
    - 제품 아이디 유효성 검증
        - FK참조로 존재하는 데이터만 입력 가능
        - 데이터 타입으로 제한 가능
    - 구분자 문자 선택 필요 없음
    - 목록길이 제한이 필요하다면 애플리케이션에서 항목 수로 제한
    - 교차테이블의 다른 장점
        - 인덱스 활용으로 성능 향상
            - FK선언 칼럼: 내부적 인덱스 생성(각 DB문서 확인 필요)
        - 칼럼 추가로 다른 정보 저장 가능

### 순진한 트리